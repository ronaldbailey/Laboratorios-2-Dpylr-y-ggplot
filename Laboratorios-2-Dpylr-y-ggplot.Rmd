---
title: "**Laboratorios #2 – Dplyr y ggplot**"
output:
  pdf_document:
    latex_engine: pdflatex
---

Para esta y la siguiente parte deberá subir su solución en un archivo
.Rmd colocando la pregunta completa como Rmarkdown y la respuesta que
considere adecuada.

Los sistemas de renta de bicycletas se basan en kioskos que son puestos
en diferentes áreas de una ciudad. En estos kioskos las personas pueden
suscribirse, rentar y devolver las bicicletas.
Esto permite que el usuario rente un bicicleta y la pueda devolver en
otro lado. Actualmente hay mas de 500 de estos proyectos alrededor del
mundo.

Estos kioskos se vuelven sensores del flujo de personas dentro de
ciudades.

Su tarea es contestar las preguntas de este documento, basadas en la
data que se presenta en el siguiente link.

- Variables
    - **datetime**: hourly date + timestamp
    - **season**: 1 = spring, 2 = summer, 3 = fall, 4 = winter
    - **holiday**: whether the day is considered a holiday
    - **workingday**: whether the day is neither a weekend nor holiday
    - **weather**:
        - 1: Clear, Few clouds, Partly cloudy, Partly cloudy
        - 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist
        - 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds
        - 4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog
    - **temp**: temperature in Celsius
    - **atemp**: "feels like" temperature in Celsius
    - **humidity**: relative humidity
    - **windspeed**: wind speed
    - **casual**: number of non-registered user rentals initiated
    - **registered**: number of registered user rentals initiated
    - **count**: number of total rentals
    
```{r}

dataset = read.csv("dataset.csv")

head(dataset)

```


## 1. Cree un conjunto de columnas nuevas: día, mes, año, hora y minutos a partir de la comlumna datetime, para esto investigue como puede “desarmar” la variable datetime utilizando lubridate y mutate. 


```{r}
# bibliotecas necesarias
library(lubridate)
library(dplyr)

# convertir la columna "dteday" a un formato de fecha y hora
dataset$dteday <- ymd(dataset$dteday)

# extraer las partes de la fecha y la hora
dataset <- dataset %>%
  mutate(
    dia = day(dteday),
    mes = month(dteday),
    año = year(dteday),
  )


dataset$hora =   dataset$hr

# Verificar el resultado
head(dataset)

```

## 2. ¿Qué mes es el que tiene la mayor demanda? Muestre una tabla y una gráfica


Asumiendo que cada linea representa que un cliente haya pedido una bicicleta debo contar las filas para saber cuantas bicicletas se han pedido.

```{r}
dataset_mes_año = dataset %>% 
                  select(año,mes) %>% 
                  group_by(año,mes) %>%
                  summarize(registros = n())

print(dataset_mes_año)
```

crear una nueva columan de fechas para que los datos salgan ordenados

```{r}

dataset_mes_año <- dataset_mes_año %>%
  mutate(año_mes = as.Date(paste(año, mes, "01", sep = "-"), format = "%Y-%m-%d"))

```


```{r}
library(ggplot2)
dataset_mes_año %>%
  ggplot(aes(x = año_mes, y = registros)) +
  geom_col(fill = "blue") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y-%m") +
  labs(title = "Demanda total de alquiler de bicicletas por mes",
       x = "Mes y Año",
       y = "Demanda total") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Buscando el maximo de cada columna


```{r}
dataset_mes_año$registros %>% max()

```
Estos serian los meses en donde hay un maximo de consumidores del servicio

```{r}
dataset_mes_año %>% filter(registros == (dataset_mes_año$registros %>% max()))
```

## 3. ¿Qué rango de hora es la de mayor demanda? Muestre una tabla y una gráfica

```{r}
dataset_mes_año_hora = dataset %>% 
                  select(hora) %>% 
                  group_by(hora) %>%
                  summarize(registros = n())

```
```{r}
dataset_mes_año_hora$registros %>% max()

```

```{r}
dataset_mes_año_hora %>% filter(registros == (dataset_mes_año_hora$registros %>% max())) 
```
```{r}
dataset_mes_año_hora 
```

```{r}
dataset_mes_año_hora %>% filter(registros == (dataset_mes_año_hora$registros %>% max())) %>% select(hora, registros)
```


```{r}

dataset_mes_año_hora %>%
  ggplot(aes(x = as.factor(hora), y = registros)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_text(aes(label = registros), vjust = -0.5, color = "black") +
  labs(title = "Cantidad de registros por hora",
       x = "Hora del día",
       y = "Registros") +
  theme_minimal()

```

si sacara el promedio por mes solo lo dividiria entre 24 porque son dos años pero tendria la misma forma la grafica.


## 4. ¿Qué temporada es la mas alta? Muestre una tabla.


```{r}
dataset_temporada = dataset %>% 
                  select(season) %>% 
                  group_by(season) %>%
                  summarize(registros = n())

```



```{r}
dataset_temporada$registros %>% max()
```
```{r}
dataset_temporada 
```

En la temporada 3 es la mas alta



## 5. ¿A que temperatura disminuye la demanda? Muestre una gráfica para analizar y dar su respuesta.


Agrupando una suma por temperatura

```{r}
dataset_temperatura = dataset %>% 
                  select(temp) %>% 
                  group_by(temp) %>%
                  summarize(registros = n())

```

```{r}
dataset_temperatura$registros %>% max()

```
```{r}
dataset_temperatura %>% filter(registros == (dataset_temperatura$registros %>% min())) 
```



```{r}

dataset_temperatura %>%
  ggplot(aes(x = as.factor(temp), y = registros)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_text(aes(label = registros), vjust = -0.5, color = "black") +
  labs(title = "Cantidad de registros por hora",
       x = "Temperatura",
       y = "Registros") +
  theme_minimal()

```


```{r}

head(dataset_temperatura %>% arrange(registros))

```
La demanda disminuye en temperaturas muy bajas o muy altas

## 6. ¿A que humedad disminuye la demanda? Muestre una gráfica para analizar y dar su respuesta.


```{r}
dataset_humedad = dataset %>% 
                  select(hum) %>% 
                  group_by(hum) %>%
                  summarize(registros = n())

```

```{r}
dataset_humedad$registros %>% min()

```

```{r}
dataset_humedad %>% filter(registros == (dataset_humedad$registros %>% min())) 
```



```{r}

dataset_humedad %>%
  ggplot(aes(x = as.factor(hum), y = registros)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_text(aes(label = registros), vjust = -0.5, color = "black") +
  labs(title = "Cantidad de registros por hora",
       x = "Humedad",
       y = "Registros") +
  theme_minimal()

````
```{r}

head(dataset_humedad %>% arrange(registros))

````



## 7. ¿Que condiciones climáticas serian ideales para nuestra demanda? (considere una función de densidad bivariable para la temperatura y la humedad)


** Temperaturas medias y humedades entre el 70 y menos del 90%


8. Mueste una gráfica de la densidad de rentas.


```{r}

ggplot(dataset, aes(x = cnt)) +
  geom_density(fill = "steelblue") +
  labs(title = "Densidad de Rentas",
       x = "Cantidad de Rentas",
       y = "Densidad") +
  theme_minimal()

```
